# شرح مفصّل — **Static Host Route** (مسار ثابت لعنوان مضيّق / مضيف)

رح أشرح لك كل شيء عن **Static Host Route** خطوة بخطوة: ما هو، متى نستخدمه، كيف نكتبه على أجهزة Cisco (وملاحظات لأنواع الأجهزة الأخرى)، أمثلة عملية، سلوك الـ next-hop والـ recursive lookup، وطرق التحقق والتشخيص، ونصائح أمنية وعمليّة.

---

## 1) شو يعني **Static Host Route**؟

**Static Host Route** هو مسار ثابت (مُدخَل يدوياً) يشير إلى **عنوان مضيف واحد** فقط — يعني قناع الشبكة يكون `/32` في IPv4 (أو `/128` في IPv6).  
مثال IPv4: `192.0.2.5/32` — هذا المسار يطابق عنوان IP واحد فقط.

---

## 2) لماذا نستخدم Host Route؟ (Use cases)

- توجيه لحلقة واجهة أو جهاز واحد (مثل جهاز إدارة أو سيرفر مهم) عبر رابط أو بوابة معيّنة.
    
- توجيه لـ VPN tunnel endpoint أو IPsec peer محدد.
    
- تجاوز مسار ديناميكي لعنوان محدد (override route learned by protocol).
    
- إنشاء **blackhole** لمضيف مُسيء (تحويله إلى Null0).
    
- توجيه منافذ ثابتة في سيناريوهات NAT أو policy routing.
    
- الوصول لمضيف عبر وصلة point-to-point حيث لا يوجد subnet كامل مذكور.
    

---

## 3) الصيغة العامة على Cisco IOS (IPv4)

### أ. باستخدام next-hop IP (الأكثر صحيحية ومُستحسنة)

```
ip route 192.0.2.5 255.255.255.255 10.0.0.2
```

- هنا `10.0.0.2` هو الـ next-hop IP (يجب أن يكون قابلاً للوصول على شبكة مباشرة أو عن طريق مسار آخر — recursive lookup ممكن).
    

### ب. باستخدام واجهة الخروج (exit-interface) — احذر

```
ip route 192.0.2.5 255.255.255.255 GigabitEthernet0/1
```

- هذا يعمل إذا كانت الشبكة التالية مباشرة (على شبكات NBMA قد يختلف السلوك). على الشبكات Ethernet، إعطاء واجهة فقط يجعل الراوتر يحاول إرسال الإطار لعنوان MAC للـ destination (ممكن يفشل إن لم يكن on-link). كتابة next-hop أفضل عادة.
    

### ج. بصيغة CIDR (بعض الإصدارات تسمح)

```
ip route 192.0.2.5/32 10.0.0.2
```

(تتوفر الصيغة المختصرة على بعض الإصدارات الحديثة.)

---

## 4) أمثلة عملية وشرح السلوك

### مثال 1 — توجيه لمضيف عبر بوابة محددة

```
ip route 203.0.113.45 255.255.255.255 10.1.1.2
```

- أي حزمة لِـ `203.0.113.45` تذهب إلى `10.1.1.2`. الراوتر سيقوم بعملية **recursive lookup** للتحقق من كيفية الوصول إلى `10.1.1.2` (هل هو متصل مباشرة أم يتطلب مسار آخر).
    

### مثال 2 — host route كـ blackhole

```
ip route 192.0.2.13 255.255.255.255 Null0
```

- أي حركة متجهة للمضيف تُسقط محلياً (useful لوقف هجوم أو منع الوصول).
    

### مثال 3 — floating static host route (احتياط)

```
ip route 198.51.100.10 255.255.255.255 10.0.0.2 250
```

- هنا `250` هو Administrative Distance أعلى، يعني هذا المسار سيُستخدم فقط إذا لم تتوفر مسارات أكثر ثقة (مثلاً مسار ديناميكي). يُستخدم كخيار احتياطي.
    

### IPv6

```
ipv6 route 2001:db8::5/128 2001:db8:1::2
```

---

## 5) Recursive lookup & ARP — ليش مهم تعرفهم؟

- **Recursive lookup:** عندما تضع next-hop IP (مثلاً 10.0.0.2) وكان هذا الـ next-hop ليس متصلاً مباشرة بواجهتك، الراوتر سيبحث عن مسار إلى 10.0.0.2 في جدول التوجيه. إذا لم يجد كيفية الوصول إليه، سيتم اعتبار الـ static غير قابل للاستخدام (inactive).
    
- **ARP:** إذا الـ next-hop IP موجود على نفس الـ L2 network، الراوتر يحتاج لتحويله إلى MAC عبر ARP قبل الإرسال. لذا تأكد أن الـ next-hop reachable وARP يعمل.
    

---

## 6) التدفّق مع بروتوكولات التوجيه (Interactions)

- **Host static route** له Administrative Distance ثابت (static = 1 افتراضياً) لذا غالباً سينتصر على المسارات الديناميكية.
    
- إذا أردت أن تعطي أولوية أدنى (حتى لا تُفشل مسارات ديناميكية أفضل)، استخدم floating static بزيادة AD.
    
- عند وجود route ديناميكي و static متضارب: معيار الاختيار = أولاً أطبيعية الـ AD (أصغر أفضل)، ثم metric.
    

---

## 7) أمور عملية وتوصيات (Best Practices)

- **استخدم next-hop IP بدل exit-interface** على شبكات Ethernet عامة — أكثر مرونة وأكثر أماناً (لكن في بعض الشبكات point-to-point يمكن استخدام الواجهة فقط).
    
- حدّث التوثيق: ادوّن كل static host routes في مخطط العناوين.
    
- استخدم floating static إن رغبت بالاحتياطية لصيانة أو تعطل.
    
- تجنّب الإفراط باستخدام host routes — يمكن أن يملأ جدول التوجيه إذا كان عددها كبير.
    
- لتطبيقات الحماية، استخدم `Null0` لعمل blackhole بدل استخدام firewall rules مكثفة على الراوتر.
    

---

## 8) أوامر التحقق والتشخيص (Cisco)

- عرض جدول التوجيه:
    

```
show ip route
show ip route 192.0.2.5
```

- تحقق حالة اللغة (CEF / forwarding):
    

```
show ip cef 192.0.2.5
```

- تحقق ARP:
    

```
show ip arp | include 10.1.1.2
```

- تحقق إذا المسار مُطبّق (active) أو لا:
    

```
show ip route | include 192.0.2.5
```

- تتبع المسار للحزم:
    

```
traceroute 192.0.2.5
```

- لو أردت مراقبة تغيّرات المسارات أثناء التجربة:
    

```
debug ip routing
```

(استخدم `debug` بحذر على الأجهزة الإنتاجية).

---

## 9) أمثلة سيناريو واقعي قصير

عندك شبكة فرع A والـ VPN peer بالمركز عنوانه `203.0.113.5`. تريد أن تتأكد أن كل حركة إلى هذا الـ peer تذهب عبر وصلة معينة `10.2.2.2` (ISP):

```
ip route 203.0.113.5 255.255.255.255 10.2.2.2
```

لو فشل ال-ISP الأول وترغب بتحويله عبر مسار احتياطي:

```
ip route 203.0.113.5 255.255.255.255 10.3.3.2 250
```

الراوتر سيستخدم المسار ذو AD الافتراضي (1) أولاً، وإذا اختفى سيستخدم المسار الاحتياطي لأن AD=250 أعلى.

---

## 10) ملخّص سريع

- **Static Host Route = مسار ثابت لعنوان واحد** (`/32` أو `/128`).
    
- مفيد لحالات خاصة: الوصول إلى endpoint، blackhole، override مسارات ديناميكية، توجيه لحلقات أو تونلات.
    
- استخدم `ip route <host> 255.255.255.255 <next-hop>` وفضّل تحديد next-hop IP.
    
- راقب حالة الـ route باستخدام `show ip route`, `show ip cef`, و`show ip arp`.
    
- فكّر في AD (floating static) إذا تريد سلوك احتياطي.
    

---

إذا تحب أقدر:

- أقدملك **سيناريو عملي** من شبكتك (اعطني مثال عناوين) وأكتب لك الأوامر خطوة-بـ-خطوة + كيف تتأكد أنها تعمل.
    
- أو أشرح كيف تدمج host routes مع **policy-based routing** أو **NAT** — أي واحدة تبغى؟

[[70- Static Network Route]]