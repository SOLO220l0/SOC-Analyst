# شرح مفصّل — **Routed Interface Addressing** (توجيه عنون لواجهات راوتد)

سأشرح الموضوع خطوة بخطوة وبأمثلة عملية (ومتضمنة أوامر Cisco شائعة) حتى يصير واضح كيف تختار عناوين الـ IP لواجهات الراوتر أو السويتش الراوتد وكيف تتصرف في سيناريوهات مختلفة.

---

## 1) ما هو **Routed Interface**؟

**Routed Interface** هي واجهة جهاز شبكي (Router أو Layer-3 Switch) تُعامل كشبكة IP مُباشرة (Layer 3) — أي لها عنوان شبكة (IP + subnet mask) وتشارك في التوجيه (routing). أمثلة:

- المنفذ الفيزيائي على راوتر (GigabitEthernet0/0) مع عنوان `192.168.10.1/24`.
    
- SVI (Switch Virtual Interface) على Layer-3 switch مثل `interface Vlan10` مع عنوان `10.10.10.1/24`.
    
- واجهات نقطة إلى نقطة بين راوترين (يمكن استخدام /30 أو /31).
    

مقابل ذلك، **Switchport (Layer-2)** لا يحمل عنوان IP على نفس الواجهة (إلا SVI)، ويعمل في نفس الشبكة دون توجيه.

---

## 2) لماذا طريقة العنوَن مهمة؟

- تحدد الاتصالات المباشرة (من وإلى الجهاز).
    
- تؤثر على الجداول التوجيهية (routing table).
    
- تؤثر على التخطيط الأمني (ACLs، NAT).
    
- تحدد عدد العناوين المتاحة لكل رابط / شبكة.
    

---

## 3) أنواع روابط وعناوين شائعة والـ subnet المناسب لكل نوع

### أ. شبكات LAN عادية (شبكة مضيفة)

- استخدم قناع مثل `/24` أو `/26` بناءً على عدد المضيفين.
    
- مثال: شبكة مكتب صغيرة 50 جهاز → استخدم `/26` (يعطي 62 عنواناً قابلين للاستخدام).
    
    - مثال عملي: `192.168.20.0/26`
        
        - الشبكة: `192.168.20.0`
            
        - البث (broadcast): `192.168.20.63`
            
        - العناوين القابلة للاستخدام: `192.168.20.1` — `192.168.20.62`
            

### ب. وصلات نقطة إلى نقطة بين راوترين

- عادة `/30` أو `/31`:
    
    - **/30**: يعطي شبكتين قابلتين للاستخدام (2 مضيفين) — جيد للرواتر القديم.
        
        - مثال: `10.0.0.0/30` → usable: `10.0.0.1` و `10.0.0.2`، broadcast `10.0.0.3`.
            
    - **/31**: في IPv4 يُسمح به للوصلات Point-to-Point (RFC 3021) ويعطي عنوانين فقط ولا يستهلك broadcast — مفيد لتوفير العناوين.
        
        - مثال: `10.0.0.4/31` → العنوانان `10.0.0.4` و `10.0.0.5`.
            

### ج. شبكات توصيل أجهزة إدارة أو مراقبة

- استخدم شبكات صغيرة /30 أو /29 حسب الحاجة لعزل الوصول الإداري.
    

---

## 4) أمثلة عملية على التهيئة (Cisco IOS)

### أ. تهيئة واجهة راوتر في LAN

```
interface GigabitEthernet0/0
 description LAN-to-Switch
 ip address 192.168.10.1 255.255.255.0
 no shutdown
```

- هنا `192.168.10.1` هي الـ gateway للمضيفين في الشبكة `192.168.10.0/24`.
    

### ب. واجهة نقطة إلى نقطة (/30)

```
interface GigabitEthernet0/1
 description To-RouterB
 ip address 10.0.0.1 255.255.255.252   ! /30 = 255.255.255.252
 no shutdown
```

- الطرف الآخر يكون `10.0.0.2/30`.
    

### ج. SVI على Layer-3 switch

```
interface Vlan10
 description Users VLAN 10
 ip address 10.10.10.1 255.255.255.0
 no shutdown
```

- الواجهات الفيزيائية التي تنتمي إلى VLAN10 يجب أن تكون `switchport access vlan 10` (في Layer-2 ports).
    

---

## 5) قواعد أساسية عند اختيار العناوين (Best Practices)

1. **خطط عنون مركزي (IP Addressing Plan)**: احتفظ بمخطط موثق يبين الشبكات، الأقنعة، ونطاقات VLAN.
    
2. **عزل الشبكات الحساسة**: استخدم VLANs وواجهات راوتد منفصلة للشبكات الحساسة.
    
3. **استخدم /30 أو /31 للوصلات Point-to-Point** لتوفير العناوين.
    
4. **لا تستخدم عناوين متداخلة** — كل شبكة يجب أن تكون غير متداخلة (non-overlapping).
    
5. **خصص نطاقات ثابتة لعناوين الخوادم** (مثلاً DHCP reservations أو نطاقات ثابتة).
    
6. **تسجيل ووثّق** كل عنوان تستخدمه على أجهزة الشبكة لتسهيل الصيانة.
    
7. **استخدم NAT وACLs بحذر**: عناوين الواجهات تؤثر في ACLs وقيع NAT.
    

---

## 6) إعدادات مساعدة مهمة مرتبطة بواجهات الراوتر

### أ. Default Gateway للمضيفين

- في كل شبكة، واجهة الراوتر أو SVI تكون الـ default gateway للمضيفين (مثلاً `192.168.10.1`).
    

### ب. DHCP Relay (ip helper-address) على الراوتر/SVI

عند وجود DHCP Server في شبكة مختلفة:

```
interface Vlan20
 ip address 172.16.20.1 255.255.255.0
 ip helper-address 10.1.1.5    ! عنوان سيرفر DHCP
```

### ج. Secondary IP addresses (نادراً ما تُستخدم)

- يمكن إضافة عنوان ثانوي لواجهة إذا احتجت الشبكة لتملك أكثر من شبكة على نفس الواجهة:
    

```
interface GigabitEthernet0/0
 ip address 192.168.1.1 255.255.255.0
 ip address 192.168.2.1 255.255.255.0 secondary
```

- لكن يفضل تصميم الشبكات بشكل نظيف بدل استخدام secondary كثيراً.
    

### د. مسودات وأمان (ACLs)

- ضع ACLs على الواجهات الراوتد للتحكم في المرور بين الشبكات:
    

```
access-list 100 permit ip 192.168.10.0 0.0.0.255 any
interface GigabitEthernet0/0
 ip access-group 100 in
```

---

## 7) أمثلة حسابية سريعة (لتجنب الأخطاء)

- مثال: `/24` = قناع `255.255.255.0` → عناوين قابلة للاستخدام = 2^8 − 2 = 256 − 2 = 254 (من `.1` إلى `.254`).
    
    - أعمل العملية رقمًا برقم: 2^8 = 256 ثم ناقص 2 = 254.
        
- مثال: `/30` = قناع `255.255.255.252` → 2^2 − 2 = 4 − 2 = 2 عناوين قابلة للاستخدام.
    

---

## 8) سيناريو عملي صغير — تصميم شبكة مبسطة

- متطلبات: فرع صغير يحتاج:
    
    - VLAN للمستخدمين 50 جهاز → استخدم `192.168.50.0/26` (62 عناوين صالحة).
        
    - VLAN للطابعات 10 طابعات → `192.168.51.0/28` (14 عناوين صالحة).
        
    - وصلة إلى المكتب الرئيسي → نقطة-إلى-نقطة `/30` باستخدام `10.0.0.0/30`.
        

تهيئة واجهات (أمثلة):

```
! SVI للمستخدمين
interface Vlan50
 ip address 192.168.50.1 255.255.255.192

! SVI للطابعات
interface Vlan51
 ip address 192.168.51.1 255.255.255.240

! وصلة للمكتب الرئيسي
interface GigabitEthernet0/1
 ip address 10.0.0.1 255.255.255.252
```

---

## 9) أخطاء شائعة تجنبها

- استخدام قناع خاطئ يؤدي لتداخل الشبكات.
    
- نسيان تفعيل الواجهة (`no shutdown`).
    
- وضع ACLs تمنع المرور اللازم بين الشبكات.
    
- عدم توثيق مخطط العناوين — يؤدي لفوضى لاحقة.
    
- استخدام نطاقات عامة أو متضاربة مع عنوان شبكة الإنترنت (إذا تستخدم NAT/مرور للإنترنت).
    

---

## 10) خلاصة سريعة

- **Routed Interface Addressing** يعني إعطاء كل واجهة Layer-3 في الشبكة عنوان IP/قناع مناسب يتماشى مع تصميم الشبكة واحتياجات العدد والأمن.
    
- التخطيط المسبق، استخدام أحجام شبكات مناسبة (مثل /30 للوصلات P2P، /24 أو /26 للـ LAN حسب الحاجة)، وتوثيق كل شيء هي مفاتيح النجاح.
    
- استخدم أوامر الـ IOS لتهيئة الواجهات، وأضف خدمات مساعدة مثل DHCP relay وACLs حسب الحاجة.
    

---

إذا تحب، أقدر:

- أرسم لك **مخطط عنون** لبيئة محددة (قدر الأجهزة، عدد المستخدمين، احتياجات VLAN) — أعطيني الأرقام وسأعطيك خطة عنون كاملة مع الشبكات والـ subnets والـ gateways.
    
- أقدّم **أمثلة متقدمة** عن IP address summarization, route redistribution, أو استخدام IPv6 لواجهات الراوتد.


[[68- How Routing Works]]